<!DOCTYPE html>
<html>
<head>
    <title>Tadasana Posture Demo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="style.css">
</head>
<body>

<h2>Tadasana Pose Correction</h2>

<div id="cameraBox">
    <video id="video" autoplay playsinline></video>
</div>

<p id="status">Initializing cameraâ€¦</p>

<div id="feedbackBox"></div>

<script>
const video = document.getElementById("video");
const statusTxt = document.getElementById("status");
const feedbackBox = document.getElementById("feedbackBox");

async function startCamera() {
    try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true });
        video.srcObject = stream;
        statusTxt.innerText = "Camera ready. Hold your posture!";
        analyzeLoop();
    } catch (err) {
        statusTxt.innerText = "Camera access denied.";
    }
}

function captureFrame() {
    let canvas = document.createElement("canvas");
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    canvas.getContext("2d").drawImage(video, 0, 0);

    return new Promise(resolve => {
        canvas.toBlob(blob => resolve(blob), "image/jpeg", 0.7);
    });
}

async function analyzeLoop() {
    const blob = await captureFrame();
    const form = new FormData();
    form.append("file", blob, "frame.jpg");

    let res = await fetch("/analyze", { method: "POST", body: form });
    let data = await res.json();

    feedbackBox.innerHTML = "";
    data.feedback.forEach(f => {
        let item = document.createElement("div");
        item.className = f.includes("Good") ? "good" : "bad";
        item.innerText = f;
        feedbackBox.appendChild(item);
    });

    setTimeout(analyzeLoop, 200);
}

startCamera();
</script>
</body>
</html>
